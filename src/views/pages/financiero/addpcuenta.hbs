{{>tables}}

<div class="card">
    <div class="card-header">{{#if cuentas}}Actualizar{{else}}Agregar{{/if}} Producto Contable</div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6 mb-2">
                <div class="form-floating">
                    <input type="text" name="cuenta" id="cuenta" class="form-control" placeholder="Cuenta"
                        autocomplete="off" value="{{cuentas.code_name}}">
                    <label for="cuenta"><i class="fas fa-signature fa-fw me-2"></i>Código / Nombre</label>
                </div>
            </div>
            <div class="col-md-6 mb-4">
                <div class="form-floating">
                    <textarea name="description" id="description" class="form-control"
                        placeholder="Descripción del Producto">{{cuentas.description}}</textarea>
                    <label for="description"><i class="fas fa-signature fa-fw me-2"></i>Descripción</label>
                </div>
            </div>
            <div class="col-md-6 mb-4">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="activo" name="activo" {{#if (eq cuentas.activo 1)}}checked="true"{{/if}}>
                    <label class="form-check-label" for="activo">Activo</label>
                </div>
                <select class="form-select" name="cuenta_activo" id="cuenta_activo">
                    <option value="">Seleccione una Cuenta</option>
                    {{#each cactivos}}
                    <option value="{{cuenta}}" {{#if (eq ../cuentas.cuenta_activo cuenta)}}selected{{/if}}>{{nombre}}</option>
                    {{/each}}
                </select>
            </div>
            <div class="col-md-6 mb-4">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="pasivo" name="pasivo" {{#if (eq cuentas.pasivo 1)}}checked="true"{{/if}}>
                    <label class="form-check-label" for="pasivo">Pasivo</label>
                </div>
                <select class="form-select" name="cuenta_pasivo" id="cuenta_pasivo">
                    <option value="">Seleccione una Cuenta</option>
                    {{#each cpasivos}}
                    <option value="{{cuenta}}" {{#if (eq ../cuentas.cuenta_pasivo cuenta)}}selected{{/if}} >{{nombre}}</option>
                    {{/each}}
                </select>
            </div>
        </div>
    </div>
    <div class="card-footer">
        <button class="btn btn-success" onclick="saveProducto();">{{#if cuentas}}Guardar Cambios{{else}}Crear Producto{{/if}}</button>
    </div>
</div>

<script>

    var fact = "{{cuentas.activo}}"
    var fpas = "{{cuentas.pasivo}}"

    console.log(fact + ' ' + fpas)

    $(function () {
        if(fact !== "1"){
            $("#cuenta_activo").prop("selectedIndex", 0)
            $("#cuenta_activo").addClass("ocultar")
        }
        if(fpas !== "1"){
            $("#cuenta_pasivo").prop("selectedIndex", 0)
            $("#cuenta_pasivo").addClass("ocultar")
        }
    });

    $("#activo").on("change", () => {
        if ($("#activo").prop('checked')) {
            $("#cuenta_activo").removeClass("ocultar")
        } else {
            $("#cuenta_activo").addClass("ocultar")
            $("#cuenta_activo").prop("selectedIndex", 0)
        }
    })

    $("#pasivo").on("change", () => {
        if ($("#pasivo").prop('checked')) {
            $("#cuenta_pasivo").removeClass("ocultar")
        } else {
            $("#cuenta_pasivo").addClass("ocultar")
            $("#cuenta_pasivo").prop("selectedIndex", 0)
        }
    })

    async function saveProducto() {
        if ($("#cuenta").val() == "") {
            msg = "Debes Ingresar el Código o Nombre del Producto";
            $("#cuenta").focus();
            sendAlert(msg);
        } else if ($("#description").val() == "") {
            msg = "Debes Escribir la Descripción para el Producto";
            $("#description").focus();
            sendAlert(msg);
        } else if ($("#activo").prop("checked") && $("#cuenta_activo option").filter(':selected').val() == "") {
            msg = "Debes Seleccionar una Cuenta de Activo";
            $("#cuenta_activo").focus();
            sendAlert(msg);
        } else if ($("#pasivo").prop("checked") && $("#cuenta_pasivo option").filter(':selected').val() == "") {
            msg = "Debes Seleccionar una Cuenta de Pasivo";
            $("#cuenta_pasivo").focus();
            sendAlert(msg);
        } else {
            var Dater = new Date()
            const datos = {
                'id': "{{cuentas._id}}",
                'code_name': $("#cuenta").val(),
                'description': $("#description").val(),
                'activo': $("#activo").prop("checked") ? 1 : 0,
                'pasivo': $("#pasivo").prop("checked") ? 1 : 0,
                'cuenta_activo': $("#cuenta_activo option").filter(':selected').val(),
                'cuenta_pasivo': $("#cuenta_pasivo option").filter(':selected').val(),
                'date_record': (Dater.getDate() < 10 ? '0' + Dater.getDate() : Dater.getDate()) + '/' + ((Dater.getMonth() + 1) < 10 ? '0' + (Dater.getMonth() + 1) : (Dater.getMonth() + 1)) + '/' + Dater.getFullYear() + ' ' + (Dater.getHours() < 10 ? '0' + Dater.getHours() : Dater.getHours()) + ':' + (Dater.getMinutes() < 10 ? '0' + Dater.getMinutes() : Dater.getMinutes()) + ':' + (Dater.getSeconds() < 10 ? '0' + Dater.getSeconds() : Dater.getSeconds())
            }
            await axios.post('/financiero/addpcuenta', datos).then((response) => {
                loadContent('maincuentas', '/financiero/prodfin');
            }).catch((err) => {
                console.log(err);
            })

        }
    }
</script>


{{>end}}